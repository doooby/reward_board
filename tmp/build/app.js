(()=>{var t={96:(t,e,n)=>{var i="Expected a function",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,u=parseInt,l="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,c="object"==typeof self&&self&&self.Object===Object&&self,f=l||c||Function("return this")(),h=Object.prototype.toString,v=Math.max,d=Math.min,p=function(){return f.Date.now()};function y(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function S(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==h.call(t)}(t))return NaN;if(y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var n=s.test(t);return n||a.test(t)?u(t.slice(2),n?2:8):o.test(t)?NaN:+t}t.exports=function(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError(i);return y(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),function(t,e,n){var r,o,s,a,u,l,c=0,f=!1,h=!1,w=!0;if("function"!=typeof t)throw new TypeError(i);function b(e){var n=r,i=o;return r=o=void 0,c=e,a=t.apply(i,n)}function M(t){return c=t,u=setTimeout(P,e),f?b(t):a}function _(t){var n=t-l;return void 0===l||n>=e||n<0||h&&t-c>=s}function P(){var t=p();if(_(t))return g(t);u=setTimeout(P,function(t){var n=e-(t-l);return h?d(n,s-(t-c)):n}(t))}function g(t){return u=void 0,w&&r?b(t):(r=o=void 0,a)}function m(){var t=p(),n=_(t);if(r=arguments,o=this,l=t,n){if(void 0===u)return M(l);if(h)return u=setTimeout(P,e),b(l)}return void 0===u&&(u=setTimeout(P,e)),a}return e=S(e)||0,y(n)&&(f=!!n.leading,s=(h="maxWait"in n)?v(S(n.maxWait)||0,e):s,w="trailing"in n?!!n.trailing:w),m.cancel=function(){void 0!==u&&clearTimeout(u),c=0,r=l=o=u=void 0},m.flush=function(){return void 0===u?a:g(p())},m}(t,e,{leading:r,maxWait:e,trailing:o})}},336:function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(134),s=r(n(450)),a=r(n(765)),u=function(){function t(t){var e=this;this.model={viewSize:0,avatarPosition:null,rewards:[]},this.onPositionClicked=function(t){var n,i;null===(i=(n=e.config).onPositionClick)||void 0===i||i.call(n,t)},this.onMouseMove=function(t){var n,i;null===(i=(n=e.config).onMouseOverPosition)||void 0===i||i.call(n,t)},this.config=t,this.view=new s.default({onPositionClick:this.onPositionClicked,onMouseMove:this.onMouseMove}),this.view.attach(t.element.attachShadow({mode:"closed"})),this.updateModel(i(i({},this.model),{avatarPosition:o.Position.parse(t.defaultPosition),rewards:Object.freeze(t.rewards.slice(0))})),new ResizeObserver((function(t){try{var n=t[0].contentRect.width;e.updateModel(i(i({},e.model),{viewSize:n}))}finally{}})).observe(this.view.wrapper)}return t.prototype.updateModel=function(t){this.model=t,this.view.render(this.model)},t.prototype.possibleSteps=function(){var t=this.model.avatarPosition;return t?t.possibleSteps():{up:!1,right:!1,down:!1,left:!1}},t.prototype.step=function(t){var e=this,n=this.model.avatarPosition;if(n){var i=n.step(t);i&&i.isOnBoard()&&setTimeout((function(){var t,n;return null===(n=(t=e.config).onStepRequested)||void 0===n?void 0:n.call(t,i)}),0)}},t.prototype.setPosition=function(t){var e=o.Position.parse(t);this.updateModel(i(i({},this.model),{avatarPosition:e}))},t.prototype.rewardOnPositionGet=function(t){return t&&this.model.rewards.find((function(e){var n=e.x,i=e.y;return n===t.x&&i===t.y}))},t.findButtons=function(t){return new a.default(t)},t}();e.default=u},765:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["up","right","down","left"],i=function(){function t(t){var e=this;this.buttons={};for(var i=function(n){var i=t(n);r.buttons[n]=i,i.addEventListener("click",(function(){var t;return null===(t=e.onClick)||void 0===t?void 0:t.call(e,n)}))},r=this,o=0,s=n;o<s.length;o++)i(s[o]);this.disableAll()}return t.prototype.disableAll=function(){for(var t=0,e=n;t<e.length;t++){var i=e[t];this.buttons[i].disabled=!0}},t.prototype.update=function(t){for(var e=t.possibleSteps(),i=0,r=n;i<r.length;i++){var o=r[i];this.buttons[o].disabled=!e[o]}},t}();e.default=i},948:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.content=t.content.cloneNode(!0)}return t.prototype.set=function(t,e){var n=this.content.querySelector('[data-value="'+t+'"]');n&&(n.textContent=e)},t.prototype.insertInto=function(t){t.innerHTML="",t.appendChild(this.content)},t}();e.default=n},450:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(134),o=i(n(96)),s=function(){function t(t){var e=this;this.mouseOverPosition=null,this.canvasCtx=null,this.currentModel=null,this.currentSizes=null,this.onPositionClick=function(t){t.stopPropagation();var n=f(e,t);(null==n?void 0:n.isOnBoard())&&e.onPositionClickCallback(n)},this.onMouseMove=o.default((function(t){var n=e.mouseOverPosition;t.stopPropagation();var i=f(e,t);null!==i&&(i.isOnBoard()?(null==n?void 0:n.x)===i.x&&(null==n?void 0:n.y)===i.y||(e.mouseOverPosition=i):e.mouseOverPosition=null,n!==e.mouseOverPosition&&e.onMouseMoveCallback(e.mouseOverPosition||void 0))}),400),this.onPositionClickCallback=t.onPositionClick,this.onMouseMoveCallback=t.onMouseMove,this.wrapper=document.createElement("div"),this.wrapper.classList.add("wrapper"),this.canvas=document.createElement("canvas"),this.resetCanvas(0),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("click",this.onPositionClick),this.wrapper.appendChild(this.canvas)}return t.prototype.attach=function(t){t.appendChild(this.wrapper)},t.prototype.render=function(t){this.currentModel=t,t.viewSize===this.canvas.width&&t.viewSize===this.canvas.height||this.resetCanvas(t.viewSize);var e=this.canvasCtx;if(null!==e){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.viewSize,t.viewSize),this.currentSizes={view:t.viewSize,slot:c(2.52,t.viewSize),stepMargin:c(0,t.viewSize),step:c(2.52,t.viewSize),stepBorder:c(.21000000000000002,t.viewSize),avatar:c(2.1,t.viewSize)},e.lineWidth=this.currentSizes.stepBorder,e.strokeStyle="black";for(var n=0,i=r.mapTiles;n<i.length;n++)a(e,i[n],this.currentSizes);for(var o=0,s=t.rewards;o<s.length;o++)u(e,s[o],this.currentSizes);t.avatarPosition&&function(t,e,n){var i=n.avatar,r=l(e,n),o=r[0],s=r[1];t.fillStyle="orange",t.setTransform(1,0,0,1,o-i/2,s-i/2),t.fillRect(0,0,i,i)}(e,t.avatarPosition,this.currentSizes)}},t.prototype.resetCanvas=function(t){this.canvas.width=t,this.canvas.height=t,this.canvasCtx=this.canvas.getContext("2d"),null!==this.canvasCtx&&(this.canvasCtx.imageSmoothingEnabled=!1)},t}();function a(t,e,n){var i=n.slot,r=n.stepMargin,o=n.step,s=l(e,n),a=s[0],u=s[1];t.setTransform(1,0,0,1,a-i/2,u-i/2),t.strokeRect(r,r,o,o)}function u(t,e,n){var i=n.avatar,r=l(e,n),o=r[0],s=r[1];t.fillStyle=e.style.color,t.setTransform(1,0,0,1,o-i/2,s-i/2),t.fillRect(0,0,i,i)}function l(t,e){var n=e.view,i=e.slot;return[n/2+t.x*i,n/2+t.y*i]}function c(t,e){return Math.ceil(t/100*e)}function f(t,e){if(!t.currentModel||!t.currentSizes)return null;var n=t.currentSizes.slot,i=t.currentModel.viewSize/2,o=t.canvas.getBoundingClientRect(),s=Math.floor((e.clientX-o.x-i+n/2)/t.currentSizes.slot),a=Math.floor((e.clientY-o.y-i+n/2)/t.currentSizes.slot);return new r.Position(s,a)}e.default=s},276:function(t,e){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.fetch=void 0,e.fetch=function(t,e){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:i={method:(null==e?void 0:e.method)||"POST",credentials:"include",headers:n({"Content-Type":"application/json"},null==e?void 0:e.headers),body:(null==e?void 0:e.data)&&JSON.stringify(e.data)},r.label=1;case 1:return r.trys.push([1,4,,5]),[4,globalThis.fetch(t,i)];case 2:return[4,r.sent().json()];case 3:return[2,r.sent()];case 4:return r.sent(),[2,null];case 5:return[2]}}))}))}},629:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(336)),o=n(276),s=i(n(948));globalThis.D3O_RewardBoard=function(t){try{t({Board:r.default,fetch:o.fetch,Template:s.default})}catch(t){console.error("D3O_RewardBoard failed",t)}}},134:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mapTiles=e.Position=e.RIM_LAS_LEVEL_STEPS=e.RIM_STEPS=e.RIMS_LEVELS=void 0,e.RIMS_LEVELS=4,e.RIM_STEPS=3,e.RIM_LAS_LEVEL_STEPS=8;var n=function(){function t(t,e){if("number"!=typeof t||isNaN(t)||"number"!=typeof e||isNaN(e))throw new Error("en.Position.invalid");this.x=t,this.y=e,Object.freeze(this)}return t.parse=function(e){if(!e)return null;try{return new t(e.x,e.y)}catch(t){return console.error("D3O_RewardBoard invalid position:",e),console.error(t),null}},t.prototype.distance=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},t.prototype.isOnBoard=function(){var t=0===this.x,n=0===this.y;if(t&&n)return!0;var i=Math.abs(this.x),r=Math.abs(this.y);if(t||n)return(t?r:i)<=e.RIMS_LEVELS*e.RIM_STEPS-e.RIM_STEPS+e.RIM_LAS_LEVEL_STEPS;if(i%e.RIM_STEPS==0||r%e.RIM_STEPS==0){var o=[i,r].sort((function(t,e){return t-e})),s=o[0],a=o[1],u=a%e.RIM_STEPS==0,l=u?a/e.RIM_STEPS:s/e.RIM_STEPS;return!(l>e.RIMS_LEVELS)&&(u?s:a)<=l*e.RIM_STEPS}return!1},t.prototype.possibleSteps=function(){return{up:this.step("up").isOnBoard(),right:this.step("right").isOnBoard(),down:this.step("down").isOnBoard(),left:this.step("left").isOnBoard()}},t.prototype.step=function(e){switch(e){case"up":return new t(this.x,this.y-1);case"right":return new t(this.x+1,this.y);case"down":return new t(this.x,this.y+1);case"left":return new t(this.x-1,this.y)}},t}();function i(t,n){e.mapTiles.push({x:t,y:n})}e.Position=n,e.mapTiles=[],i(0,0);for(var r=e.RIMS_LEVELS*e.RIM_STEPS+e.RIM_LAS_LEVEL_STEPS-e.RIM_STEPS,o=-r;o<=r;o+=1)0!==o&&(i(o,0),i(0,o));for(var s=0;s<e.RIMS_LEVELS;s+=1){var a=s*e.RIM_STEPS+e.RIM_STEPS;for(o=-a;o<a;o+=1)0!==o&&(i(o,-a),i(a,o),i(o,a),i(-a,o));i(a,-a),i(a,a),i(-a,a),i(-a,-a)}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n(629)})();